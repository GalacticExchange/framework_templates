#!/bin/bash
chmod 0755 /usr/bin/neo4j
mkdir -p /var/run/neo4j
/usr/bin/neo4j start

throw() {
echo $1
exit 5
}

retries=10
interval=3

n=0
while [ $n != $retries ]
do
if [ ! -z "$(curl localhost:7474)" ]; then
echo 'Neo4j ready!'
break;
fi
echo "Neo4j check #$n"
n=$(( n+1 ))
sleep $interval
done

if [ $n -eq $retries ]; then
throw "Neo4j retries amount exceeded"

fi


sleep 5
/usr/bin/curl -H "Content-Type: application/json" -X POST -d '{"password":"password"}' -u neo4j:neo4j http://localhost:7474/user/neo4j/password >> /tmp/curl.txt
/usr/bin/curl -H "Content-Type: application/json" -X POST -d '{"password":"neo4j"}' -u neo4j:password http://localhost:7474/user/neo4j/password >> /tmp/curl.txt
/usr/bin/neo4j stop